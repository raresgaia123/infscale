---
- name: start controller
  host: cisco-research-7
  tasks:
    - name: start controller
      shell:
        work_dir: ~/projects/infscale
        env_activate_command: conda activate pytorch-dev
        log_level: INFO
        action: start
        entity: controller
        log_level: INFO

    - name: start agent 1
      shell:
        work_dir: ~/projects/infscale
        env_activate_command: conda activate pytorch-dev
        log_level: INFO
        action: start
        entity: agent
        extra_args: agent_id_1
        log_level: INFO

- name: run resnet linear
  host: cisco-research-7
  tasks:
    - name: run job
      shell:
        work_dir: ~/projects/infscale
        env_activate_command: conda activate pytorch-dev
        log_level: INFO
        action: start
        entity: job
        extra_args: examples/resnet152/auto/linear.yaml
        log_level: INFO

- name: check job complete
  host: cisco-research-7
  type: 'status'
  statuses:
    - complete
    - failed
  job_id: "job1"

- name: cleanup processes
  type: 'cleanup'
